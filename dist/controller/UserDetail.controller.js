sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter"],function(e,t,s){"use strict";return e.extend("auths.controller.UserDetail",{formatter:s,onInit:function(){sessionStorage.setItem("goToLaunchpad","");var e=this.getOwnerComponent().getRouter();e.attachRouteMatched(this.onRouteMatched,this);this.getRouter().getRoute("UserDetail").attachPatternMatched(this._onObjectMatched,this);document.addEventListener("keydown",this.handleF8Pressed.bind(this))},handleF8Pressed:function(e){if(e.which===119){var t=this;t.onSaveChanges()}},onAfterRendering:function(){var e=this;sessionStorage.setItem("goToLaunchpad","");window.addEventListener("message",function(t){var s=t.data;if(s.action=="goToMainPage"){e.onNavBack()}})},onRouteMatched:function(){var e=new t({editable:false,createMethod:false});this.getView().setModel(e,"UserDetail")},onSaveChanges:function(){var e=this,t=this.getModel();if(!this.getModel("UserDetail").getProperty("/createMethod")){var s=this.getModel("UserDetail").getProperty("/sPath"),i=t.getObject(s);delete i.__metadata;i.Partner=this.byId("inPartner").getSelectedKey();i.Name=this.byId("inName").getValue();i.Contact=this.byId("inContact").getValue();i.Nationality=this.byId("inNationality").getSelectedKey();i.BirthDate=this.byId("DP2").getDateValue();i.UsrEmail=this.byId("inEmail").getValue();i.UsrTypeId=this.byId("inUsrTypeId").getSelectedKey();i.Password=this.byId("inPassword").getValue();i.RoleId=this.byId("inRoleId").getSelectedKey();t.update(s,i,{success:function(t){new sap.m.MessageBox.success(e.getResourceBundle().getText("userSuccessText"),{title:e.getResourceBundle().getText("userSuccessTitle"),actions:[sap.m.MessageBox.Action.OK],emphasizedAction:sap.m.MessageBox.Action.OK,onClose:function(t){if(t===sap.m.MessageBox.Action.OK){e.getModel().refresh(true);e.getRouter().navTo("RouteMain")}}})},error:function(e){var t=JSON.parse(e.responseText).error.message.value;sap.m.MessageBox.alert(t,{icon:"ERROR",onClose:null,styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit})}})}else{var a={},o=true;a.Partner=this.byId("inPartner").getSelectedKey();a.Name=this.byId("inName").getValue();a.Contact=this.byId("inContact").getValue();a.Nationality=this.byId("inNationality").getSelectedKey();a.BirthDate=this.byId("DP2").getDateValue();a.UsrEmail=this.byId("inEmail").getValue();a.UsrTypeId=this.byId("inUsrTypeId").getSelectedKey();a.Password=this.byId("inPassword").getValue();a.RoleId=this.byId("inRoleId").getSelectedKey();t.create("/xTQAxUSR01_DD",a,{success:function(t){new sap.m.MessageBox.success(e.getResourceBundle().getText("userCreatedSuccessText"),{title:e.getResourceBundle().getText("userCreatedSuccessTitle"),actions:[sap.m.MessageBox.Action.OK],emphasizedAction:sap.m.MessageBox.Action.OK,onClose:function(t){if(t===sap.m.MessageBox.Action.OK){e.getModel().refresh(true);e.getRouter().navTo("RouteMain")}}})},error:function(e){var t=JSON.parse(e.responseText).error.message.value;sap.m.MessageBox.alert(t,{icon:"ERROR",onClose:null,styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit})}})}},onPermToChange:function(e){var t=this.getModel("UserDetail").getProperty("/editable");if(t){this.getModel("UserDetail").setProperty("/editable",false);e.oSource.setProperty("icon","sap-icon://edit")}else{this.getModel("UserDetail").setProperty("/editable",true);e.oSource.setProperty("icon","sap-icon://not-editable")}},onNavBack:function(){sessionStorage.setItem("goToLaunchpad","X");this.getRouter().navTo("RouteMain")},_onObjectMatched:function(e){var t="/xTQAxUSR01_DD"+e.getParameter("arguments").objectId;this._bindView(t)},_bindView:function(e){this.getModel("UserDetail").setProperty("/sPath",e);this.getModel("UserDetail").setProperty("/editable",false);this.getModel("UserDetail").setProperty("/createMethod",false);var t=this.getModel("UserDetail");if(e!="/xTQAxUSR01_DD('000')"){this.byId("SimpleFormDisplayColumn_threeGroups234").setTitle("Detalhes Utilizador");this.getView().bindElement({path:e,events:{dataRequested:function(){t.setProperty("/busy",true)},dataReceived:function(e){t.setProperty("/busy",false)}}})}else{this.onCreateMethod()}},onCreateMethod:function(){var e=[],t=[],s={id:"inPartner",value:""},i={id:"inEmail",value:""},a={id:"inName",value:""},o={id:"inContact",value:""},n={id:"inPassword",value:""},r={id:"inNationality",value:""},l={id:"DP2",value:""},d={id:"MainPage",title:""},u={id:"SimpleFormDisplayColumn_threeGroups234",title:"Criar Utilizador"};this.getModel("UserDetail").setProperty("/editable",true);this.getModel("UserDetail").setProperty("/createMethod",true);e.push(s,i,a,o,n,r,l);t.push(d,u);this.onManageValues(e);this.onManageTitle(t)},onManageValues:function(e){if(e.length>0){e.forEach(e=>{this.byId(e.id).setValue(e.value)})}},onManageTitle:function(e){if(e.length>0){e.forEach(e=>{this.byId(e.id).setTitle(e.title)})}}})});
//# sourceMappingURL=UserDetail.controller.js.map