sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/core/Popup","sap/m/VBox","sap/ui/layout/form/SimpleForm","sap/m/ColumnListItem","sap/m/MessageBox"],function(e,t,a,i,s,n,o,r){"use strict";var l=false;var u=[{id:"requestTable",icontabfilterID:"_IDGenIconTabFilter1",oStandard:"partner,usrid,name,UserTypeText,usr_email,status,last_logon",entitySet:"xTQAxUSR01_DD",smartFilterId:"smartFilterBarGroups",press:"onRequestTablePress",selectionChange:"onChangeSelection",oButtons:{button1:{id:"btCreate",text:"i18n>Create",press:"onCreateRequest",type:"Emphasized"},button2:{id:"btDelete",text:"i18n>Delete",press:"onDeleteRequest"},button3:{id:"btUnlocked",icon:"sap-icon://locked",press:"onChangeStatus"}}},{id:"requestTableApps",icontabfilterID:"_IdTabFilterAppsSettings",oStandard:"app_id,app_header,app_subheader,app_icon,app_link,grp_title,app_actived",entitySet:"xTQAxAPPLICATIONS_DD",smartFilterId:"",press:"onRequestAppTablePress",selectionChange:"onChangeSelectionApps",oButtons:{button1:{id:"btnCreateApp",text:"i18n>Create",press:"onCreateApp",type:"Emphasized"},button3:{id:"btnDeleteApp",text:"i18n>Delete",press:"onDeleteApp",enabled:"Main>/appeditable"},button2:{id:"btnTranslateApp",text:"i18n>Translate",press:"onTranslateApp",enabled:"Main>/appeditable"},button4:{id:"btnActiveApp",text:"i18n>Active",press:"onActiveApp",enabled:"Main>/appeditable"}}},{id:"requestTableGroups",icontabfilterID:"_IdTabFilterGroupSettings",oStandard:"grp_id,grp_title,created_by,created_at,changed_by,changet_at",entitySet:"xTQAxLAUNCHPAD_GROUP_VH",smartFilterId:"",press:"onRequestGroupTablePress",selectionChange:"onChangeSelectionGroups",oButtons:{button1:{id:"btnCreateGroup",text:"i18n>Create",press:"onCreateGroup",type:"Emphasized"},button3:{id:"btnDeleteGroup",text:"i18n>Delete",press:"onDeleteGroup",enabled:"Main>/appeditable"},button2:{id:"btnTranslateGroup",text:"i18n>Translate",press:"onTranslateGroup",enabled:"Main>/groupeditable"}}}];return e.extend("auths.controller.Main",{formatter:a,onInit:function(){var e=new t({busy:false,delay:0,oStandard:"partner,usrid,name,UserTypeText,usr_email,status,last_logon",oSmartTableView:"",variantInput:"Standard"}),a=new t({appeditable:false,groupeditable:false});sessionStorage.setItem("goToLaunchpad","X");this.setModel(e,"mainView");this.getView().setModel(a,"Main");this.getRouter().attachRouteMatched(this.getUserAuthentication,this)},onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("NotFound");return}},handleF5Pressed:function(e){if(e.which===116){e.preventDefault();var t=this,a=this.getModel("global").getProperty("/selectedKey");if(a==="user-settings"||!a){t.onCreateRequest()}else if(a==="role"){t.onAddRole()}else if(a==="applications"){t.onCreateApp()}else if(a==="group-settings"){t.onCreateGroup()}}else if(e.which===118){var t=this;t.onViewDetail()}},onCreateRequest:function(){sessionStorage.setItem("goToLaunchpad","");this.getRouter().navTo("UserDetail",{objectId:"xTQAxUSR01_DD(('000')".substring("/xTQAxUSR01_DD".length)})},onCreateApp:function(){sessionStorage.setItem("goToLaunchpad","");this.getRouter().navTo("AppDetail",{objectId:"xTQAxAPPLICATIONS_DD(('000')".substring("/xTQAxAPPLICATIONS_DD".length)})},onAddRole:function(){var e=this;var t=new sap.m.Dialog({type:sap.m.DialogType.Message,title:this.getView().getModel("i18n").getResourceBundle().getText("CreateNewRole"),content:[new sap.m.Label({text:this.getView().getModel("i18n").getResourceBundle().getText("RoleName")}).addStyleClass("dialog-label"),new sap.m.Input({width:"100%"}).addStyleClass("dialog-input")],buttons:[new sap.m.Button({text:this.getView().getModel("i18n").getResourceBundle().getText("Create"),press:function(){var a=t.getContent()[1].getValue();e.getModel("global").setProperty("/newRole",a);e.getModel("global").setProperty("/create","true");t.close();var i="/AuthorizationsHeader('999')";e.getRouter().navTo("Detail",{objectId:i.substring("/AuthorizationsHeader".length)})}}),new sap.m.Button({text:this.getView().getModel("i18n").getResourceBundle().getText("Cancel"),press:function(){t.close()}})],afterClose:function(){t.destroy()}});t.open()},onCreateGroup:function(){var e=this;var t=new sap.m.Dialog({type:sap.m.DialogType.Message,title:e.getView().getModel("i18n").getResourceBundle().getText("CreateGroup"),content:[new sap.m.Label({text:e.getView().getModel("i18n").getResourceBundle().getText("GrpName")}),new sap.m.Input({id:"groupNameInput"})],buttons:[new sap.m.Button({text:e.getView().getModel("i18n").getResourceBundle().getText("Create"),press:function(){var a=sap.ui.getCore().byId("groupNameInput").getValue();e.onCreateGroupRequest(a);t.destroy();t.close()}}),new sap.m.Button({text:e.getView().getModel("i18n").getResourceBundle().getText("Cancel"),press:function(){t.close();t.destroy()}})]});t.open()},onChangeIconTabBar:function(e){var t=e.oSource.getSelectedKey();if(t=="applications"){this.onBuildSmartTable(u[1])}else if(t=="group-settings"){this.onBuildSmartTable(u[2])}this.getModel("global").setProperty("/selectedKey",t)},onViewDetail:function(){var e=this,t=this.byId("idIconTabBarMulti"),a=t.getSelectedKey();if(a=="user-settings"){e.onRequestTablePress()}else if(a=="applications"){e.onRequestAppTablePress()}else if(a=="group-settings"){e.onRequestGroupTablePress()}},onOpenPressed:function(e){sessionStorage.setItem("goToLaunchpad","");var t=e.getSource().getBindingContext().getPath();this.getModel("global").setProperty("/create",false);this.getRouter().navTo("Detail",{objectId:t.substring("/AuthorizationsHeader".length)})},onChangeStatus:function(){var e=this,t=sap.ui.getCore().byId("requestTable").getTable(),a=t.getSelectedContextPaths()[0],i=this.getModel(),s=i.getObject(a);delete s.__metadata;s.UsrStatus="change";i.update(a,s,{success:function(t){e.getModel().refresh(true);sap.m.MessageBox.success("Utilizador Atualizado")},error:function(e){}})},onRequestTablePress:function(e){sessionStorage.setItem("goToLaunchpad","");if(e){var t=e.getSource().getBindingContextPath();this.getRouter().navTo("UserDetail",{objectId:t.substring("/xTQAxUSR01_DD".length)})}else{var a=this.byId("requestTable"),t=a.getSelectedItem().getBindingContext().sPath;this.getRouter().navTo("UserDetail",{objectId:t.substring("/xTQAxUSR01_DD".length)})}},onChangeSelection:function(e){sap.ui.getCore().byId("btUnlocked").setProperty("icon","sap-icon://locked");var t=e.oSource.getSelectedContextPaths(),a=true;t.forEach(e=>{var t=this.getModel().getObject(e);if(t.UsrStatus!="Blocked")a=false});if(a){sap.ui.getCore().byId("btUnlocked").setProperty("icon","sap-icon://unlocked");sap.ui.getCore().byId("btUnlocked").setProperty("enabled",true)}else{sap.ui.getCore().byId("btUnlocked").setProperty("icon","sap-icon://locked");sap.ui.getCore().byId("btUnlocked").setProperty("enabled",true)}},onChangeSelectionGroups:function(e){var t=e.oSource.getSelectedContextPaths()[0];this.getModel("Main").setProperty("/groupeditable",true)},onDeleteGroup:function(){var e=sap.ui.getCore().byId("requestTableGroups").getTable().getSelectedContextPaths()[0],t=this,a=this.getModel();a.remove(e,{success:function(e,a){if(a.headers.message!=""){var i=t.getView().getModel("i18n").getResourceBundle().getText("onGroupsAssigned")+" "+a.headers.message;sap.m.MessageBox.information(i)}else{sap.m.MessageBox.success(t.getView().getModel("i18n").getResourceBundle().getText("onDeleteSucessGroup"))}},error:function(e){}})},onRequestGroupTablePress2:function(e){var t=this;if(e){var a=e.oSource.getBindingContextPath(),i=this.getModel().getObject(a)}else{var s=sap.ui.getCore().byId("requestTableGroups"),n=s.getTable().getSelectedItem().getBindingContext().sPath,i=s.getModel().getObject(n)}var o=new sap.m.Dialog({type:sap.m.DialogType.Message,title:t.getView().getModel("i18n").getResourceBundle().getText("GrpSettings"),content:[new sap.m.Label({text:t.getView().getModel("i18n").getResourceBundle().getText("GrpName")}),new sap.m.Input({id:"groupNameInput",value:i.grp_title})],buttons:[new sap.m.Button({text:t.getView().getModel("i18n").getResourceBundle().getText("Change"),press:function(){var e=sap.ui.getCore().byId("groupNameInput").getValue();t.onSaveGroup(e,a);o.destroy();o.close()}}),new sap.m.Button({text:t.getView().getModel("i18n").getResourceBundle().getText("Cancel"),press:function(){o.close();o.destroy()}})]});o.open()},onSaveGroup:function(e,t){var a=this,i=this.getModel(),s={};s.grp_title=e;i.update(t,s,{success:function(e){a.getModel().refresh(true);sap.m.MessageBox.success("Grupo Atualizado")},error:function(e){}})},onCreateGroupRequest:function(e){var t=this,a=this.getModel(),i={};i.grp_title=e;a.create("/xTQAxLAUNCHPAD_GROUP_VH",i,{success:function(e){t.getModel().refresh(true)},error:function(e){var t=JSON.parse(e.responseText).error.message.value;sap.m.MessageBox.alert(t,{icon:"ERROR",onClose:null,styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit})}})},onChangeSelectionApps:function(e){var t=e.oSource.getSelectedContextPaths()[0],a=this.getModel().getObject(t);if(t){this.getModel("Main").setProperty("/appeditable",true);if(a.app_actived){this.byId("btnActiveApp").setProperty("text",this.getView().getModel("i18n").getResourceBundle().getText("Disable"))}else{this.byId("btnActiveApp").setProperty("text",this.getView().getModel("i18n").getResourceBundle().getText("Active"))}}else{this.getModel("Main").setProperty("/appeditable",false)}},onRequestAppTablePress:function(e){if(e){var t=e.getSource().getBindingContextPath();this.getRouter().navTo("AppDetail",{objectId:t.substring("/xTQAxAPPLICATIONS_DD".length)})}else{var a=sap.ui.getCore().byId("requestTableApps"),t=a.getTable().getSelectedItem().getBindingContext().sPath;this.getRouter().navTo("AppDetail",{objectId:t.substring("/xTQAxAPPLICATIONS_DD".length)})}},onRequestGroupTablePress:function(e){if(e){var t=e.getSource().getBindingContextPath();this.getRouter().navTo("GroupDetail",{objectId:t.substring("/xTQAxLAUNCHPAD_GROUP_VH".length)})}else{var a=sap.ui.getCore().byId("requestTableGroups"),t=a.getTable().getSelectedItem().getBindingContext().sPath;this.getRouter().navTo("GroupDetail",{objectId:t.substring("/xTQAxLAUNCHPAD_GROUP_VH".length)})}},onActiveApp:function(){e.check=false;var e=this,t=sap.ui.getCore.byId("requestTableApps"),a=t.getTable().getSelectedContextPaths()[0],i=this.getModel().getObject(a),s=this.getModel(),n={};delete i.__metadata;if(i.app_actived)n.app_actived=false;else{e.check=true;n.app_actived=true}s.update(a,n,{success:function(t){e.getModel().refresh(true);sap.m.MessageBox.success("Aplicação Atualizada");if(e.check){e.byId("btnActiveApp").setProperty("text",e.getView().getModel("i18n").getResourceBundle().getText("Disable"))}else{e.byId("btnActiveApp").setProperty("text",e.getView().getModel("i18n").getResourceBundle().getText("Active"))}},error:function(e){}});if(e.check){if(n.app_actived){this.byId("btnActiveApp").setProperty("text",this.getView().getModel("i18n").getResourceBundle().getText("Disable"))}else{this.byId("btnActiveApp").setProperty("text",this.getView().getModel("i18n").getResourceBundle().getText("Active"))}}},onTranslateApp:function(){var e=sap.ui.getCore().byId("requestTableApps"),t=e.getTable().getSelectedItem();if(t){var a=t.getBindingContext().sPath,i=this.getModel().getObject(a),s=i.app_id,o=i.app_header,r=i.app_subheader;if(!this.oResizableDialog){var l=new n({layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"{i18n>AppLangu}"}),new sap.m.Select({id:"inAppLangu",layoutData:new sap.m.FlexItemData({styleClass:"sapUiSmallMarginBottom"}),required:true,items:[new sap.ui.core.Item({text:"EN",key:"EN"}),new sap.ui.core.Item({text:"PT",key:"PT"}),new sap.ui.core.Item({text:"ES",key:"S"})],change:function(e){sap.ui.getCore().byId("inAppHeader").setValue("");sap.ui.getCore().byId("inAppSubHeader").setValue("");var t=e.getSource().getSelectedKey();var a=sap.ui.getCore().byId("inAppHeader");var i=sap.ui.getCore().byId("inAppSubHeader");if(t==="EN"){a.setValue(o);i.setValue(r)}else{a.setValue("");i.setValue("")}}}),new sap.m.Label({text:"{i18n>AppHeader}"}),new sap.m.Input({id:"inAppHeader",layoutData:new sap.m.FlexItemData({styleClass:"sapUiSmallMarginBottom"}),required:true}),new sap.m.Label({text:"{i18n>AppSubHeader}"}),new sap.m.Input({id:"inAppSubHeader",layoutData:new sap.m.FlexItemData({styleClass:"sapUiSmallMarginBottom"}),required:true})]});var u=new sap.m.Button({text:"{i18n>Save}",press:function(){var e=true;var t=this.getModel();l.getContent().forEach(function(t){if(t instanceof sap.m.Input){if(t.getRequired()&&!t.getValue()){e=false;t.setValueState("Error");return false}else{t.setValueState("None")}}});if(e){var a={};var i=this;var n=sap.ui.getCore().byId("inAppLangu").getSelectedKey();a.APP_ID=s;a.Langu=n;a.AppHeader=sap.ui.getCore().byId("inAppHeader").getValue();a.AppSubheader=sap.ui.getCore().byId("inAppSubHeader").getValue();t.create("/Translations",a,{success:function(e){sap.m.MessageBox.success(i.getResourceBundle().getText("createtranslate"))}})}}.bind(this)});var p=new sap.m.Button({text:"{i18n>close}",press:function(){this.oResizableDialog.close();this.oResizableDialog.destroy();this.oResizableDialog.destroy();this.oResizableDialog=null}.bind(this)});this.oResizableDialog=new sap.m.Dialog({title:"{i18n>Translate}",contentWidth:"440px",contentHeight:"430px",resizable:true,content:[l],buttons:[u,p]});if(this.oResizableDialog){var g=sap.ui.getCore().byId("inAppHeader");var d=sap.ui.getCore().byId("inAppSubHeader");g.setValue(o);d.setValue(r)}this.getView().addDependent(this.oResizableDialog)}}else{sap.m.MessageBox.warning("Por favor selecione uma aplicação para traduzir!")}this.oResizableDialog.open()},onTranslateGroup:function(){var e=sap.ui.getCore().byId("requestTableGroups"),t=e.getTable().getSelectedItem();if(t){var a=t.getBindingContext().sPath,i=this.getModel().getObject(a),s=i.grp_id,o=i.grp_title;if(!this.oResizableDialog){var r=new n({layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"{i18n>AppLangu}"}),new sap.m.Select({id:"inGroupLangu",layoutData:new sap.m.FlexItemData({styleClass:"sapUiSmallMarginBottom"}),required:true,items:[new sap.ui.core.Item({text:"EN",key:"EN"}),new sap.ui.core.Item({text:"PT",key:"PT"}),new sap.ui.core.Item({text:"ES",key:"S"})],change:function(e){sap.ui.getCore().byId("inGroupHeader").setValue("");var t=e.getSource().getSelectedKey();var a=sap.ui.getCore().byId("inGroupHeader");if(t==="EN"){a.setValue(o)}else{a.setValue("")}}}),new sap.m.Label({text:"{i18n>GroupHeader}"}),new sap.m.Input({id:"inGroupHeader",layoutData:new sap.m.FlexItemData({styleClass:"sapUiSmallMarginBottom"}),required:true})]});var l=new sap.m.Button({text:"{i18n>Save}",press:function(){var e=true;var t=this.getModel();r.getContent().forEach(function(t){if(t instanceof sap.m.Input){if(t.getRequired()&&!t.getValue()){e=false;t.setValueState("Error");return false}else{t.setValueState("None")}}});if(e){var a={};var i=sap.ui.getCore().byId("inGroupLangu").getSelectedKey();a.GrpId=s;a.Langu=i;a.GrpTitle=sap.ui.getCore().byId("inGroupHeader").getValue();t.create("/TranslationGroups",a,{success:function(e){sap.m.MessageBox.success(g.getResourceBundle().getText("createtranslate"));this.byId("inGroupHeader").setValue("")}})}}.bind(this)});var u=new sap.m.Button({text:"{i18n>close}",press:function(){this.oResizableDialog.close();this.oResizableDialog.destroy();this.oResizableDialog.destroy();this.oResizableDialog=null}.bind(this)});this.oResizableDialog=new sap.m.Dialog({title:"{i18n>Translate}",contentWidth:"440px",contentHeight:"430px",resizable:true,content:[r],buttons:[l,u]});if(this.oResizableDialog){var p=sap.ui.getCore().byId("inGroupHeader");p.setValue(o)}this.getView().addDependent(this.oResizableDialog)}}else{var g=this;sap.m.MessageBox.warning(g.getResourceBundle().getText("selectRow"))}this.oResizableDialog.open()},onDeleteApp:function(e){var t=this,a=sap.ui.getCore().byId("requestTableApps"),i=a.getTable().getSelectedContextPaths()[0],s=this.getModel(),n="false";if(e==true){n="true"}s.remove(i,{headers:{message:n},success:function(e,a){var i=a.headers.message;if(i!=""){if(i!="Success"){var s=t.getView().getModel("i18n").getResourceBundle().getText("onAppsAssigned")+" "+i+" "+t.getView().getModel("i18n").getResourceBundle().getText("onContinueAppsAssigned");sap.m.MessageBox.confirm(s,{icon:"WARNING",actions:["Continue",sap.m.MessageBox.Action.CLOSE],emphasizedAction:"Continue",textDirection:sap.ui.core.TextDirection.Inherit,onClose:function(e){if(e=="Continue"){l=true;t.onDeleteApp(l)}}})}else{sap.m.MessageBox.success(t.getView().getModel("i18n").getResourceBundle().getText("onDeleteSucess"))}}},error:function(e){}})},onDeleteRequest:function(){var e=this,t=sap.ui.getCore().byId("requestTable"),a=t.getTable().getSelectedContextPaths()[0],i=this.getModel(),s="true";i.remove(a,{headers:{message:s},success:function(e,t){sap.m.MessageBox.confirm("Utilizador Eliminado",{icon:"SUCCESS",actions:[sap.m.MessageBox.Action.OK],emphasizedAction:"Continue",textDirection:sap.ui.core.TextDirection.Inherit})},error:function(e){}})},onBeforeRendering:function(){this.onStartVariants()},onStartVariants:function(){var e=this,t=this.getModel("vModel");t.read("/xTQAxUSR_VARIANTS_DD",{success:function(t){var a=t.results;a.forEach(t=>{if(t.v_default){e.getModel("mainView").setProperty("/variantInput",t.v_name);e.getModel("mainView").setProperty("/selectedVariant",t.variant_id);if(t.variant_id!="Main"){var a=JSON.parse(atob(t.fbar_settings));e.onUpdateFilterBar(a);var i=JSON.parse(atob(t.stable_settings));var s=i.map(function(e){return e.name}).join(",");if(s.endsWith(",")){s=s.substring(0,s.length-1)}e.getModel("mainView").setProperty("/oSmartTableView",s);e.onBuildSmartTable(u[0])}else{e.getModel("mainView").setProperty("/oSmartTableView",e.getModel("mainView").getProperty("/oStandard"));e.onBuildSmartTable(u[0])}}})},error:function(e){}})},onBuildSmartTable:function(e){if(e){var t=sap.ui.getCore().byId(e.id);if(t){t.destroy()}var a=sap.ui.getCore().byId(e.id);if(!a){var i=this.getView(),s=this.getModel("mainView");var n=new sap.m.OverflowToolbar({design:"Transparent"});n.addContent(new sap.m.ToolbarSpacer);for(var o=1;o<=4;o++){var r=e.oButtons["button"+o],l;if(r){if(r.text){l=new sap.m.Button({id:r.id+o,text:"{"+r.text+"}",press:this[r.press].bind(this),type:r.type})}else{l=new sap.m.Button({id:r.id+o,icon:r.icon,press:this[r.press].bind(this)})}n.addContent(l)}else{break}}var u=new sap.ui.comp.smarttable.SmartTable({id:e.id,entitySet:e.entitySet,smartFilterId:e.smartFilterId,tableType:"ResponsiveTable",header:"{i18n>entries}",showRowCount:true,customToolbar:n,enableAutoBinding:true,initialise:function(){this.onSTinitialise.bind(this);var t=u.getTable();t.setMode("SingleSelectLeft");t.attachSelectionChange(this[e.selectionChange].bind(this));t.attachUpdateFinished(function(){var a=t.getItems();if(a.length>0){a.forEach(t=>{if(t instanceof sap.m.ColumnListItem){t.setType("Navigation");t.attachPress(this[e.press].bind(this))}})}}.bind(this))}.bind(this),beforeRebindTable:this.onBeforeRebindTable.bind(this),initiallyVisibleFields:e.oStandard}).addStyleClass("sapUiSmallMarginTop");var p=i.byId(e.icontabfilterID);p.addContent(u);var g=new sap.m.OverflowToolbar({});u.setCustomToolbar(g)}}},onRouteMatched:function(){this.getUserAuthentication()},onFBarInitialise:function(e){var t=this.byId("smartFilterBarGroups").getFilterGroupItems(),a=[];t.forEach(function(e){if(e.mProperties.visibleInFilterBar){var t={name:e.mProperties.name,visibleInFilterBar:e.mProperties.visibleInFilterBar};a.push(t)}});this.getModel("mainView").setProperty("/vStandard",a)},onSTinitialise:function(e){var t=this,a=e.getSource(),i=a.getTable(),s=[],n=i.getColumns();n.forEach(function(e){var t=e.sId.lastIndexOf("-");if(t!==-1){var a=e.sId.substring(t+1)}s.push({name:a})});t.getModel("mainView").setProperty("/vSmartTableStandard",s)},onBeforeRebindTable:function(e){var t=this,a=e.getSource(),i=a.getTable(),s=[],n=i.getColumns();n.forEach(function(e){var t=e.sId.lastIndexOf("-");if(t!==-1){var a=e.sId.substring(t+1)}if(e.getVisible())s.push({name:a})});var o=this.checkArrayDifference(this.getModel("mainView").getProperty("/oSmartTableView"),s);if(o){var r=this.byId("variantInput"),l=JSON.stringify(s),u=btoa(l);this.getModel("mainView").setProperty("/SmartTableBtoa",u)}},checkArrayDifference:function(e,t){if(e.length!==t.length){return false}var a=e.slice().sort(),i=t.slice().sort();for(var s=0;s<a.length;s++){if(a[s]!==i[s]){return false}}return true},onUpdateFilterBar:function(e){var t=this.byId("smartFilterBarGroups").getFilterGroupItems();this.byId("smartFilterBarGroups").clear();t.forEach(e=>{e.setVisibleInFilterBar(false)});e.forEach(function(e){t.forEach(function(t){if(e.name===t.getName()){t.setVisibleInFilterBar(true);var a=t.getControl();var i=e.aFilters;if(i&&i.length>0){var s=i[0];if(a instanceof sap.m.Input||a instanceof sap.m.MultiInput){a.setValue("*"+s.oValue1+"*")}else if(a instanceof sap.m.Select||a instanceof sap.m.ComboBox){a.setSelectedKey(s.oValue1)}else if(a instanceof sap.m.CheckBox){a.setSelected(s.oValue1==="true"||s.oValue1===true)}}}})})},onShowVariantList:function(e){var t=this,a=this.getModel("vModel");if(!this._oPopover){var i=new sap.m.List;i.setModel(a);i.bindItems({path:"/xTQAxUSR_VARIANTS_DD",template:new sap.m.StandardListItem({title:"{v_name}"})});i.setMode(sap.m.ListMode.SingleSelectMaster);i.attachUpdateFinished(function(){this.getItems().forEach(function(e){e.removeStyleClass("sapMSelectListItemBaseSelected")});this.getItems().forEach(function(e){var a=e.getBindingContext();var i=a.getProperty("variant_id");var s=t.getModel("mainView").getProperty("/selectedVariant");if(!s){if(i==="Main"){e.addStyleClass("sapMSelectListItemBaseSelected")}}else{if(i===s){e.addStyleClass("sapMSelectListItemBaseSelected");t.byId("variantInput").setValue(a.getProperty("v_name"))}}})});i.attachSelectionChange(function(e){this.getItems().forEach(function(e){e.removeStyleClass("sapMSelectListItemBaseSelected")});var a=e.getParameter("listItem");a.addStyleClass("sapMSelectListItemBaseSelected");var i=a.getBindingContext();var s=i.getProperty("variant_id");t.getModel("mainView").setProperty("/selectedVariant",s);t.byId("variantInput").setValue(i.getProperty("v_name"));if(s!="Main"){var n=t.getModel("vModel").getObject(i.sPath),o=atob(n.fbar_settings),r=JSON.parse(o);t.onUpdateFilterBar(r);var l=JSON.parse(atob(n.stable_settings));var p=l.map(function(e){return e.name}).join(",");if(p.endsWith(",")){p=p.substring(0,p.length-1)}t.getModel("mainView").setProperty("/oSmartTableView",p);t.onBuildSmartTable(u[0])}else{t.onUpdateFilterBar(t.getModel("mainView").getProperty("/vStandard"));t.getModel("mainView").setProperty("/oSmartTableView",t.getModel("mainView").getProperty("/oStandard"));t.onBuildSmartTable(u[0])}t._oPopover.close()});this._oPopover=new sap.m.ResponsivePopover({contentWidth:"25%",title:this.getView().getModel("i18n").getResourceBundle().getText("MyViews"),placement:"Bottom",beginButton:new sap.m.Button({text:this.getView().getModel("i18n").getResourceBundle().getText("SaveAs"),type:"Emphasized",press:function(){t.onBeforeSaveVariant();this._oPopover.close()}.bind(this)}),endButton:new sap.m.Button({text:this.getView().getModel("i18n").getResourceBundle().getText("Manage"),press:function(){t.onManageViews();this._oPopover.close()}.bind(this)}),content:[i]})}this._oPopover.openBy(e.getSource())},onManageViews:function(){if(!this._oManageDialog){var e=this.getModel("vModel");var t=new sap.m.SearchField({width:"100%",placeholder:this.getView().getModel("i18n").getResourceBundle().getText("Search"),liveChange:function(e){var t=e.oSource.getValue();var i=new sap.ui.model.Filter("v_name",sap.ui.model.FilterOperator.Contains,t);a.getBinding("items").filter([i])}});var a=new sap.m.Table({columns:[new sap.m.Column({header:new sap.m.Label({text:this.getView().getModel("i18n").getResourceBundle().getText("VariantName")})}),new sap.m.Column({header:new sap.m.Label({text:this.getView().getModel("i18n").getResourceBundle().getText("Default")})}),new sap.m.Column({header:new sap.m.Label({text:this.getView().getModel("i18n").getResourceBundle().getText("CreatedAt")})}),new sap.m.Column({header:new sap.m.Label({text:""})})]});a.setModel(e);a.bindItems({path:"/xTQAxUSR_VARIANTS_DD",template:new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{v_name}"}),new sap.m.CheckBox({enabled:{path:"variant_id",formatter:function(e){if(e=="Main")return false}},selected:"{v_default}",select:function(t){var a=t.getSource();var i=a.getBindingContext();var s=a.getSelected();var n={};n.v_default=s;e.update(i.sPath,n,{success:function(t){e.refresh(true)},error:function(e){}})}}),new sap.m.Text({text:{path:"created_at",type:new sap.ui.model.type.Date({pattern:"dd-MM-yyyy"})}}),new sap.m.Button({icon:"sap-icon://decline",visible:{path:"v_name",formatter:function(e){if(e=="Standard"){return false}}},press:function(t){var a=t.getSource();var i=a.getBindingContext();e.remove(i.sPath,{success:function(e){},error:function(e){}})}})]})});this._oManageDialog=new sap.m.Dialog({title:this.getView().getModel("i18n").getResourceBundle().getText("Manageviews"),content:[t,a],beginButton:new sap.m.Button({text:this.getView().getModel("i18n").getResourceBundle().getText("Close"),press:function(){this._oManageDialog.close()}.bind(this)})})}this._oManageDialog.open()},onBeforeSaveVariant:function(){var e=this;var t=new sap.m.Input({id:"inVariantName"});var a=new sap.m.CheckBox({text:this.getView().getModel("i18n").getResourceBundle().getText("SetDefault")});var i=new sap.m.Dialog({title:this.getView().getModel("i18n").getResourceBundle().getText("SaveView"),content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:this.getView().getModel("i18n").getResourceBundle().getText("View")}),t,a]})],buttons:[new sap.m.Button({text:this.getView().getModel("i18n").getResourceBundle().getText("Save"),type:"Emphasized",press:function(){e.onSaveVariant(t.getValue(),a.getSelected());i.destroy()}}),new sap.m.Button({text:this.getView().getModel("i18n").getResourceBundle().getText("Close"),press:function(){i.close();i.destroy()}})]});i.open()},onSaveVariant:function(e,t){var a=this,i=this.getModel("vModel"),s={},n=[],o=this.byId("smartFilterBarGroups"),r=o.getFilterGroupItems(),l=[];r.forEach(function(e){if(e.mProperties.visibleInFilterBar){var t={name:e.mProperties.name,visibleInFilterBar:e.mProperties.visibleInFilterBar};l.push(t)}});var u=JSON.stringify(l),p=btoa(u);this.getModel("mainView").setProperty("/fbarBtoa",p);var g=JSON.parse(atob(this.getModel("mainView").getProperty("/fbarBtoa")));o.getFilters().forEach(e=>{var t=e.aFilters;var a=g.find(e=>e.name===t[0]?.sPath);if(a){a.aFilters=t.length>0?t:" "}});s.v_name=e;if(this.getModel("mainView").getProperty("/fbarBtoa"))s.fbar_settings=btoa(JSON.stringify(g));else s.fbar_settings=btoa(JSON.stringify(this.getModel("mainView").getProperty("/vStandard")));if(this.getModel("mainView").getProperty("/SmartTableBtoa")){s.stable_settings=this.getModel("mainView").getProperty("/SmartTableBtoa")}else{var d=sap.ui.getCore().byId("usersTable").getTable(),c=[],h=d.getColumns();h.forEach(function(e){var t=e.sId.lastIndexOf("-");if(t!==-1){var a=e.sId.substring(t+1)}if(e.getVisible())c.push({name:a})});s.stable_settings=btoa(JSON.stringify(c))}s.app_link="AUTHORIZATIONS";s.v_default=t;i.create("/xTQAxUSR_VARIANTS_DD",s,{success:function(e){a.getModel("mainView").setProperty("/selectedVariant",e.variant_id)},error:function(e){}})},onFilterChange:function(e){var t=e.oSource.getFilterGroupItems(),a=[];t.forEach(function(e){if(e.mProperties.visibleInFilterBar){var t={name:e.mProperties.name,visibleInFilterBar:e.mProperties.visibleInFilterBar};a.push(t)}});var i=JSON.stringify(a),s=btoa(i);this.getModel("mainView").setProperty("/fbarBtoa",s)}})});
//# sourceMappingURL=Main.controller.js.map