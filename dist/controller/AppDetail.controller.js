sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/layout/form/SimpleForm"],function(e,t,a){"use strict";return e.extend("auths.controller.AppDetail",{onInit:function(){sessionStorage.setItem("goToLaunchpad","");var e=this.getOwnerComponent().getRouter();e.attachRouteMatched(this.onRouteMatched,this);this.getRouter().getRoute("AppDetail").attachPatternMatched(this._onObjectMatched,this);document.addEventListener("keydown",this.handleF8Pressed.bind(this))},onAfterRendering:function(){var e=this;sessionStorage.setItem("goToLaunchpad","");window.addEventListener("message",function(t){var a=t.data;if(a.action=="goToMainPage"){e.onNavBack()}})},handleF8Pressed:function(e){if(e.which===119){var t=this;t.onSaveChanges()}},onRouteMatched:function(){var e=new t({editable:false,createMethod:false});this.getView().setModel(e,"AppDetail");this.byId("btChange").setProperty("visible",true);var a=[],i={id:"inAppHeader",value:""},s={id:"inAppSubHeader",value:""},n={id:"inAppIcon",value:""},o={id:"inAppLink",value:""},p={id:"inAppLangu",value:"EN"},r={id:"btCreateUpdate",text:"Save"};a.push(i,s,n,o,p,r);this.onManageValues(a)},onManageValues:function(e){if(e.length>0){e.forEach(e=>{if(e.value){this.byId(e.id).setValue(e.value)}else if(e.text){this.byId(e.id).setText(e.text)}})}},onIconSearchPressed:function(){window.open("https://sapui5.hana.ondemand.com/sdk/test-resources/sap/m/demokit/iconExplorer/webapp/index.html#/overview/SAP-icons")},onSaveChanges:function(){var e=this,t=this.getModel(),a=this.byId("btChange"),i=["inAppHeader","inAppSubHeader","inAppIcon","inAppLink"],s;if(!this.getModel("AppDetail").getProperty("/createMethod")){var n=this.getModel("AppDetail").getProperty("/sPath"),o=t.getObject(n);delete o.__metadata;var p={};p.app_header=this.byId("inAppHeader").getValue()!=o.app_header?this.byId("inAppHeader").getValue():o.app_header;p.app_subheader=this.byId("inAppSubHeader").getValue()!=o.app_subheader?this.byId("inAppSubHeader").getValue():o.app_subheader;p.app_icon=this.byId("inAppIcon").getValue()!=o.app_icon?this.byId("inAppIcon").getValue():o.app_icon;p.app_link=this.byId("inAppLink").getValue()!=o.app_link?this.byId("inAppLink").getValue():o.app_link;p.grp_id=this.byId("inGrpTitle").getSelectedKey()!=o.grp_id?this.byId("inGrpTitle").getSelectedKey():o.grp_id;p.app_actived=this.byId("inAppActived").getSelectedKey()==="true";s=this.validateFields(i);if(s&&sap.ui.core.IconPool.isIconURI(p.app_icon)){this.byId("inAppIcon").setValueState("None")}else{this.byId("inAppIcon").setValueState("Error");s=false}if(s){t.update(n,p,{success:function(t){new sap.m.MessageBox.success(e.getResourceBundle().getText("appUpdatedSuccessText"),{title:e.getResourceBundle().getText("appUpdatedSuccessTitle"),actions:[sap.m.MessageBox.Action.OK],emphasizedAction:sap.m.MessageBox.Action.OK,onClose:function(t){if(t===sap.m.MessageBox.Action.OK){e.onPermToChange(a);e.getModel().refresh(true)}}})},error:function(e){var t=JSON.parse(e.responseText).error.message.value;sap.m.MessageBox.alert(t,{icon:"ERROR",onClose:null,styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit})}})}}else{var p={};p.app_header=this.byId("inAppHeader").getValue();p.app_subheader=this.byId("inAppSubHeader").getValue();p.app_icon=this.byId("inAppIcon").getValue();p.app_link=this.byId("inAppLink").getValue();p.grp_id=this.byId("inGrpTitle").getSelectedKey();p.app_actived=this.byId("inAppActived").getSelectedKey()==="true";s=this.validateFields(i);if(s&&sap.ui.core.IconPool.isIconURI(p.app_icon)){this.byId("inAppIcon").setValueState("None")}else{this.byId("inAppIcon").setValueState("Error");s=false}if(s){t.create("/xTQAxAPPLICATIONS_DD",p,{success:function(t){new sap.m.MessageBox.success(e.getResourceBundle().getText("appCreatedSuccessText"),{title:e.getResourceBundle().getText("appCreatedSuccessTitle"),actions:[sap.m.MessageBox.Action.OK],emphasizedAction:sap.m.MessageBox.Action.OK,onClose:function(t){if(t===sap.m.MessageBox.Action.OK){e.onPermToChange(a);e.getRouter().navTo("RouteMain");e.getModel().refresh(true)}}})},error:function(e){var t=JSON.parse(e.responseText).error.message.value;sap.m.MessageBox.alert(t,{icon:"ERROR",onClose:null,styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit})}})}}},onVerifyIcon:function(e){var t=e.oSource.getValue();if(sap.ui.core.IconPool.isIconURI(t)){e.oSource.setValueHelpIconSrc(t);this.byId("OSIcon").setIcon(t)}else{e.oSource.setValueHelpIconSrc("sap-icon://sys-help-2");this.byId("OSIcon").setIcon("sap-icon://sys-help-2")}},onPermToChange:function(e){var t=this.getModel("AppDetail").getProperty("/editable");if(t){this.getModel("AppDetail").setProperty("/editable",false);e.oSource.setProperty("icon","sap-icon://edit")}else{this.getModel("AppDetail").setProperty("/editable",true);e.oSource.setProperty("icon","sap-icon://not-editable")}},onNavBack:function(){sessionStorage.setItem("goToLaunchpad","X");this.getRouter().navTo("RouteMain")},_onObjectMatched:function(e){var t="/xTQAxAPPLICATIONS_DD"+e.getParameter("arguments").objectId;this._bindView(t)},_bindView:function(e){this.getModel("AppDetail").setProperty("/sPath",e);this.getModel("AppDetail").setProperty("/editable",false);var t=this.getModel("AppDetail");if(e!="/xTQAxAPPLICATIONS_DD('000')"){this.getView().bindElement({path:e,events:{dataRequested:function(){t.setProperty("/busy",true)},dataReceived:function(e){t.setProperty("/busy",false)}}})}else{this.onCreateMethod()}},onCreateMethod:function(){this.byId("MainPage").setTitle("Criar Aplicação");this.getModel("AppDetail").setProperty("/editable",true);this.byId("btChange").setProperty("visible",false);this.byId("btCreateUpdate").setText("Create");this.getModel("AppDetail").setProperty("/createMethod",true)},onTranslateApp:function(){var e=this.byId("requestTableLanguages"),t=e.getSelectedItem().getCells(),i=t[0].getText(),s=t[1].getText(),n=t[2].getText();if(!this.oResizableDialog){var o=new a({layout:"ResponsiveGridLayout",content:[new sap.m.Label({text:"{i18n>AppLangu}"}),new sap.m.Input({id:"inLangu",enabled:false,setValue:"",layoutData:new sap.m.FlexItemData({styleClass:"sapUiSmallMarginBottom"}),required:true}),new sap.m.Label({text:"{i18n>AppHeader}"}),new sap.m.Input({id:"inAppHeader",setValue:"",layoutData:new sap.m.FlexItemData({styleClass:"sapUiSmallMarginBottom"}),required:true}),new sap.m.Label({text:"{i18n>AppHeader}"}),new sap.m.Input({id:"inAppSubHeader",setValue:"",layoutData:new sap.m.FlexItemData({styleClass:"sapUiSmallMarginBottom"}),required:true})]});var p=new sap.m.Button({text:"{i18n>Save}",press:function(){var e=true,t=this.getModel(),a=this.byId("requestTableLanguages"),i=a.getSelectedContexts()[0].sPath;o.getContent().forEach(function(t){if(t instanceof sap.m.Input){if(t.getRequired()&&!t.getValue()){e=false;t.setValueState("Error");return false}else{t.setValueState("None")}}});if(e){var s={};var n=this;s.AppHeader=sap.ui.getCore().byId("inAppHeader").getValue();s.AppSubheader=sap.ui.getCore().byId("inAppSubHeader").getValue();t.update(i,s,{success:function(){sap.m.MessageBox.success(n.getResourceBundle().getText("translatesucess"));t.refresh(true)}});this.oResizableDialog.close();this.oResizableDialog.destroy();this.oResizableDialog.destroy();this.oResizableDialog=null}}.bind(this)});var r=new sap.m.Button({text:"{i18n>close}",press:function(){this.oResizableDialog.close();this.oResizableDialog.destroy();this.oResizableDialog.destroy();this.oResizableDialog=null}.bind(this)});this.oResizableDialog=new sap.m.Dialog({title:"{i18n>Translate}",contentWidth:"440px",contentHeight:"430px",resizable:true,content:[o],buttons:[p,r]});if(this.oResizableDialog){var l=sap.ui.getCore().byId("inLangu"),d=sap.ui.getCore().byId("inAppHeader"),u=sap.ui.getCore().byId("inAppSubHeader");l.setValue(i);d.setValue(s);u.setValue(n)}this.getView().addDependent(this.oResizableDialog)}this.oResizableDialog.open()}})});
//# sourceMappingURL=AppDetail.controller.js.map